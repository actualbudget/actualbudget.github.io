"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2101],{53212:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"contributing/testing","title":"Testing","description":"Actual uses a comprehensive testing strategy to ensure code quality and reliability. This guide covers how to run tests, write tests, and debug test failures.","source":"@site/docs/contributing/testing.md","sourceDirName":"contributing","slug":"/contributing/testing","permalink":"/docs/contributing/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/actualbudget/actual/tree/master/packages/docs/docs/contributing/testing.md","tags":[],"version":"current","frontMatter":{"title":"Testing"},"sidebar":"docs","previous":{"title":"Development Setup","permalink":"/docs/contributing/development-setup"},"next":{"title":"Code Style and Conventions","permalink":"/docs/contributing/code-style"}}');var i=n(31085),r=n(71184);const l={title:"Testing"},c=void 0,a={},o=[{value:"Testing Overview",id:"testing-overview",level:2},{value:"Running Tests",id:"running-tests",level:2},{value:"Running All Tests",id:"running-all-tests",level:3},{value:"Running Tests for a Specific Package",id:"running-tests-for-a-specific-package",level:3},{value:"Running a Specific Test File",id:"running-a-specific-test-file",level:3},{value:"Unit Tests (Vitest)",id:"unit-tests-vitest",level:2},{value:"Writing Unit Tests",id:"writing-unit-tests",level:3},{value:"Testing Best Practices",id:"testing-best-practices",level:3},{value:"End-to-End Tests (Playwright)",id:"end-to-end-tests-playwright",level:2},{value:"Running E2E Tests",id:"running-e2e-tests",level:3},{value:"E2E Test Structure",id:"e2e-test-structure",level:3},{value:"Visual Regression Tests (VRT)",id:"visual-regression-tests-vrt",level:2},{value:"Debugging Test Failures",id:"debugging-test-failures",level:2},{value:"Lage Cache Issues",id:"lage-cache-issues",level:3},{value:"Tests Continue on Error",id:"tests-continue-on-error",level:3},{value:"Debug Mode",id:"debug-mode",level:3},{value:"Test Configuration",id:"test-configuration",level:2},{value:"Vitest Configuration",id:"vitest-configuration",level:3},{value:"Playwright Configuration",id:"playwright-configuration",level:3},{value:"Testing Checklist",id:"testing-checklist",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.p,{children:"Actual uses a comprehensive testing strategy to ensure code quality and reliability. This guide covers how to run tests, write tests, and debug test failures."}),"\n",(0,i.jsx)(s.h2,{id:"testing-overview",children:"Testing Overview"}),"\n",(0,i.jsx)(s.p,{children:"The project uses multiple testing frameworks:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Vitest"})," - Unit testing framework"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Playwright"})," - End-to-end (E2E) testing"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Lage"})," - Task runner for running tests across the monorepo efficiently"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"running-tests",children:"Running Tests"}),"\n",(0,i.jsx)(s.h3,{id:"running-all-tests",children:"Running All Tests"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Run all tests across all packages (recommended)\nyarn test\n\n# Run tests without cache (for debugging/CI)\nyarn test:debug\n"})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"yarn test"})," command uses Lage to run tests in parallel across all workspaces. This provides:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Parallel execution"}),": Tests run simultaneously across packages for faster feedback"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Smart caching"}),": Test results are cached in ",(0,i.jsx)(s.code,{children:".lage/"})," directory to skip unchanged packages"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Dependency awareness"}),": Understands workspace dependencies and execution order"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"running-tests-for-a-specific-package",children:"Running Tests for a Specific Package"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Run tests for loot-core\nyarn workspace loot-core run test\n\n# Run tests for the API package\nyarn workspace @actual-app/api run test\n\n# Run tests for desktop-client\nyarn workspace @actual-app/web run test\n"})}),"\n",(0,i.jsx)(s.h3,{id:"running-a-specific-test-file",children:"Running a Specific Test File"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Run E2E test for a specific file\nyarn workspace @actual-app/web run playwright test accounts.test.ts\n"})}),"\n",(0,i.jsx)(s.h2,{id:"unit-tests-vitest",children:"Unit Tests (Vitest)"}),"\n",(0,i.jsxs)(s.p,{children:["Unit tests are located alongside source files or in ",(0,i.jsx)(s.code,{children:"__tests__"})," directories. Test files use the following naming conventions:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:".test.ts"})," - TypeScript test files"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:".test.tsx"})," - React component test files"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:".spec.js"})," - JavaScript test files (legacy)"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"writing-unit-tests",children:"Writing Unit Tests"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"import { describe, it, expect, beforeEach } from 'vitest';\n// ... other imports\n\ndescribe('ComponentName', () => {\n  beforeEach(() => {\n    // Setup code\n  });\n\n  it('should behave as expected', () => {\n    // Test logic\n    expect(result).toBe(expected);\n  });\n});\n"})}),"\n",(0,i.jsx)(s.h3,{id:"testing-best-practices",children:"Testing Best Practices"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Minimize mocking"}),": Prefer real implementations over mocks when possible"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Use descriptive test names"}),": Test names should clearly describe what is being tested"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Vitest globals"}),": ",(0,i.jsx)(s.code,{children:"describe"}),", ",(0,i.jsx)(s.code,{children:"it"}),", ",(0,i.jsx)(s.code,{children:"expect"}),", ",(0,i.jsx)(s.code,{children:"beforeEach"}),", etc. are available globally"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Sync-server tests"}),": For sync-server tests, globals are explicitly defined in config"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"end-to-end-tests-playwright",children:"End-to-End Tests (Playwright)"}),"\n",(0,i.jsxs)(s.p,{children:["E2E tests are located in ",(0,i.jsx)(s.code,{children:"packages/desktop-client/e2e/"})," and use Playwright as the test runner."]}),"\n",(0,i.jsx)(s.h3,{id:"running-e2e-tests",children:"Running E2E Tests"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Run E2E tests for web\nyarn e2e\n\n# Desktop Electron E2E (includes full build)\nyarn e2e:desktop\n\n# Run E2E tests for a specific package\nyarn workspace @actual-app/web e2e\n\n# Run specific E2E test with headed browser\nyarn workspace @actual-app/web run playwright test --headed --debug accounts.test.ts\n"})}),"\n",(0,i.jsx)(s.h3,{id:"e2e-test-structure",children:"E2E Test Structure"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Tests are located in ",(0,i.jsx)(s.code,{children:"packages/desktop-client/e2e/"})]}),"\n",(0,i.jsxs)(s.li,{children:["Page models are in ",(0,i.jsx)(s.code,{children:"e2e/page-models/"})," for reusable page interactions"]}),"\n",(0,i.jsxs)(s.li,{children:["Mobile tests have ",(0,i.jsx)(s.code,{children:".mobile.test.ts"})," suffix"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"visual-regression-tests-vrt",children:"Visual Regression Tests (VRT)"}),"\n",(0,i.jsx)(s.p,{children:"Visual regression tests capture screenshots and compare them to baseline images to detect visual changes."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Run visual regression tests\nyarn vrt\n\n# Run visual regression tests in Docker (consistent environment)\nyarn vrt:docker\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Visual regression snapshots are stored per test file in ",(0,i.jsx)(s.code,{children:"*-snapshots/"})," directories. Use Docker for consistent environments when running VRT. They will be automatically generated and run on pull requests to catch unexpected visual changes."]}),"\n",(0,i.jsx)(s.h2,{id:"debugging-test-failures",children:"Debugging Test Failures"}),"\n",(0,i.jsx)(s.h3,{id:"lage-cache-issues",children:"Lage Cache Issues"}),"\n",(0,i.jsx)(s.p,{children:"If tests behave unexpectedly, the Lage cache might be causing issues:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Clear Lage cache\nrm -rf .lage\n\n# Run tests without cache\nyarn test:debug\n"})}),"\n",(0,i.jsx)(s.h3,{id:"tests-continue-on-error",children:"Tests Continue on Error"}),"\n",(0,i.jsxs)(s.p,{children:["With the ",(0,i.jsx)(s.code,{children:"--continue"})," flag, all packages run even if one fails. This helps identify all test failures across the monorepo in a single run."]}),"\n",(0,i.jsx)(s.h3,{id:"debug-mode",children:"Debug Mode"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"# Run tests in debug mode (without parallelization)\nyarn test:debug\n\n# Run specific E2E test with headed browser and debug mode\nyarn workspace @actual-app/web run playwright test --headed --debug accounts.test.ts\n"})}),"\n",(0,i.jsx)(s.h2,{id:"test-configuration",children:"Test Configuration"}),"\n",(0,i.jsx)(s.h3,{id:"vitest-configuration",children:"Vitest Configuration"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Root config: ",(0,i.jsx)(s.code,{children:"vitest.config.ts"})," (for node environment)"]}),"\n",(0,i.jsxs)(s.li,{children:["Web config: ",(0,i.jsx)(s.code,{children:"vitest.web.config.ts"})," (for browser environment)"]}),"\n",(0,i.jsx)(s.li,{children:"Sync-server tests have globals explicitly defined in config"}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"playwright-configuration",children:"Playwright Configuration"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Config file: ",(0,i.jsx)(s.code,{children:"packages/desktop-client/playwright.config.ts"})]}),"\n",(0,i.jsxs)(s.li,{children:["Test reports: ",(0,i.jsx)(s.code,{children:"packages/desktop-client/playwright-report/"})]}),"\n",(0,i.jsxs)(s.li,{children:["Test results: ",(0,i.jsx)(s.code,{children:"packages/desktop-client/test-results/"})]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"testing-checklist",children:"Testing Checklist"}),"\n",(0,i.jsx)(s.p,{children:"Before submitting a pull request:"}),"\n",(0,i.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","All existing tests pass (",(0,i.jsx)(s.code,{children:"yarn test"}),")"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","New functionality has appropriate test coverage"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Tests follow best practices (minimize mocking, descriptive names)"]}),"\n",(0,i.jsxs)(s.li,{className:"task-list-item",children:[(0,i.jsx)(s.input,{type:"checkbox",disabled:!0})," ","E2E tests pass if UI changes were made"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://vitest.dev/",children:"Vitest Documentation"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://playwright.dev/",children:"Playwright Documentation"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://microsoft.github.io/lage/",children:"Lage Documentation"})}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},71184:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>c});var t=n(14041);const i={},r=t.createContext(i);function l(e){const s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);